/**
 * Created with IntelliJ IDEA.
 * User: andre
 * Date: 11/26/13
 * Time: 4:31 PM
 * To change this template use File | Settings | File Templates.
 */

describe("The packet parser test suite", function(){

  var Parser = require("../../lib/packet-parser")
  var data = [0x73, 0x00,0x00,0x00,0x73, 0x00, 0x00, 0x6E, 0x00, 0x70, 0x73, 0x73, 0x6E, 0x70, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15,0x16, 0x17, 0x18, 0x19, 0x20];
  var doubleData = [0x73, 0x00,0x00,0x00,0x73, 0x00, 0x00, 0x6E, 0x00, 0x70, 0x73, 0x73, 0x6E, 0x70, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15,0x16, 0x17, 0x18, 0x19, 0x73, 0x6E, 0x70, 0x19, 0x18, 0x17, 0x16, 0x15, 0x14, 0x13, 0x12, 0x11, 0x10, 0x09, 0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 0x00,0x30, 0x31];

  var packet = [115,110,112,0,1,2,3,4,5,6,7,8,9,16,17,18,19,20,21,22,23,24,25];
  var packet2 = [115,110,112,25,24,23,22,21,20,19,18,17,16,9,8,7,6,5,4,3,2,1,0];

  it("should parse a packet", function(){
    var result = new Buffer(23);

    var processPacket = function(packet){
      result = packet;
    }

    var p = new Parser(processPacket);
    data.forEach(p.parse, p);

    expect(result).toEqual(packet);

  });

  it("should parse two packets", function(){
    var result = 0;
    var r0 = [];
    var r1 = [];

    var processPacket = function(packet){
      if(result == 0) {
        r0 = packet.slice(0);
      } else {
        r1 = packet.slice(0);
      }
      result++;
    }

    var p = new Parser(processPacket);
    doubleData.forEach(p.parse, p);

    expect(r0).toEqual(packet);
    expect(r1).toEqual(packet2);

  })

})